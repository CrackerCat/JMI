# JMI
**_JNI Modern Interface in C++_**

### Features

- Signature is generated by compiler only once
- getEnv() at any thread without caring about when to detach
- Support both In & Out parameters for JNI methods
- Per java class jclass cache and per method jmethodID cache
- Same C++/Java linkage: static java methods is static member function in C++

### Example:
- Setup java vm in `JNI_OnLoad`: `jmi::javaVM(vm);`
- Create a SurfaceTexture: 
```
    struct SurfaceTexture : jmi::ClassTag { static std::string name() {return "android/graphics/SurfaceTexture";}};
    jmi::JObject<SurfaceTexture> st;
    st.create(tex);
```

or

```
    jmi::object st = jmi::object::create("android/graphics/SurfaceTexture", tex);
```
- Check error:
```
    if (!st.error().empty()) {...}
```
- Create Surface from SurfaceTexture:
```
    jmi:object s = jmi::object::create("android.view.Surface", st);
```
- Call void method:
```
    st.call("updateTexImage");
```

or to cache jmethodID and call `GetMethodID()` only once internally, use `MethodTag`

```
    struct UpdateTexImage : jmi::MethodTag { static const char* name() {return "updateTexImage";}};
    st.call<UpdateTexImage>();
```

- Call method with output parameters:
```
    std::array<float, 16> mat4; //or float mat4[16];
    st.call("getTransformMatrix", std::ref(mat4)); // use std::ref() if parameter will be modified by jni method
```

or use `MethodTag`

```
    struct GetTransformMatrix : jmi::MethodTag { static const char* name() {return "getTransformMatrix";}};
    float mat4[16] mat4; // or std::array<float, 16>, valarray<float>
    st.call<GetTransformMatrix>(std::ref(mat4)); // use std::ref() if parameter will be modified by jni method
```

- Call method with a return type:
```
    jlong t = st.call<jlong>("getTimestamp");
```

or use `MethodTag`

```
    struct GetTimestamp : jmi::MethodTag { static const char* name() {return "getTimestamp";}};
    jlong t = st.call<jlong, GetTimestamp>();
```


### Known Issues

- If return type and first n arguments of call/call_static are the same, explicitly specifying return type and n arguments type is required

### Why JObject is a Template?
- To support per class jclass and per method jmethodID cache

#### MIT License
>Copyright (c) 2016-2017 WangBin

